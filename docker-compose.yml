version: '3.8'

services:
  flink-jobmanager:
    build:  # Use Dockerfile in the current directory
      context: .
      dockerfile: Dockerfile
    environment:
      JOB_MANAGER_RPC_ADDRESS: flink-jobmanager
    ports:
      - "8081:8081"
    command: jobmanager
    networks:
      - kafka_network
    volumes:
      - ./flink-sql-connector-kafka_2.12-1.14.0.jar:/opt/flink/lib/flink-sql-connector-kafka_2.12-1.14.0.jar  # Mount the JAR file
      - ./data/trading_data:/opt/flink/jobs/data/trading_data 

  flink-taskmanager:
    build:  # Use Dockerfile in the current directory
      context: .
      dockerfile: Dockerfile
    environment:
      JOB_MANAGER_RPC_ADDRESS: flink-jobmanager
      TASK_MANAGER_NUMBER_OF_TASK_SLOTS: 4  # Set the number of task slots
      FLINK_PROPERTIES: "taskmanager.numberOfTaskSlots=4"
    depends_on:
      - flink-jobmanager
    command: taskmanager
    networks:
      - kafka_network
    volumes:
      - ./flink-sql-connector-kafka_2.12-1.14.0.jar:/opt/flink/lib/flink-sql-connector-kafka_2.12-1.14.0.jar  # Mount the JAR file
      - ./data/trading_data:/opt/flink/jobs/data/trading_data 

networks:
  kafka_network:
    driver: bridge
